name: Deploy Backend & Frontend

on:
  push:
    branches:
      - main
      - dev

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set Backend Hook
        run: |
          if [ "${GITHUB_REF##*/}" == "main" ]; then
            echo "RENDER_DEPLOY_HOOK=${{ secrets.RENDER_DEPLOY_HOOK }}" >> $GITHUB_ENV
          else
            echo "RENDER_DEPLOY_HOOK=${{ secrets.RENDER_DEPLOY_HOOK_STAGING }}" >> $GITHUB_ENV
          fi
      - name: Deploy Backend
        run: curl "$RENDER_DEPLOY_HOOK"

  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set Frontend Hook
        run: |
          if [ "${GITHUB_REF##*/}" == "main" ]; then
            echo "RENDER_DEPLOY_HOOK=${{ secrets.RENDER_DEPLOY_HOOK_FRONTEND }}" >> $GITHUB_ENV
          else
            echo "RENDER_DEPLOY_HOOK=${{ secrets.RENDER_DEPLOY_HOOK_FRONTEND_STAGING }}" >> $GITHUB_ENV
          fi
      - name: Deploy Frontend
        run: curl "$RENDER_DEPLOY_HOOK"
